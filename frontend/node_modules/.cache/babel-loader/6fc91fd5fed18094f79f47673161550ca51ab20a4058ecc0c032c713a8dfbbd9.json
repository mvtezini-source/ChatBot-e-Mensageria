{"ast":null,"code":"var _jsxFileName = \"/workspaces/ChatBot-e-Mensageria/frontend/src/components/ChatWindow.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from 'react';\nimport useWebSocket from '../hooks/useWebSocket';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ChatWindow({\n  user,\n  conversationId,\n  token\n}) {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const wsRef = useWebSocket('ws://localhost:8080/?token=' + token, data => {\n    if (!data) return;\n    if (data.conversation_id == conversationId) setMessages(m => [...m, {\n      from: data.from,\n      content: data.content,\n      system: false\n    }]);\n  });\n  const inputRef = useRef();\n  useEffect(() => {\n    // Load history via REST\n    axios.get('http://localhost:8000/api/conversations/' + conversationId + '/messages', {\n      headers: {\n        Authorization: 'Bearer ' + token\n      }\n    }).then(r => setMessages(r.data)).catch(() => {});\n  }, [conversationId, token]);\n\n  // subscribe to conversation on WS when ready\n  useEffect(() => {\n    const trySubscribe = () => {\n      const ws = wsRef.current;\n      if (ws && ws.readyState === 1) {\n        ws.send(JSON.stringify({\n          type: 'subscribe',\n          conversation_id: conversationId\n        }));\n      }\n    };\n    // try immediately and again after short delay (ws may still be opening)\n    trySubscribe();\n    const t = setTimeout(trySubscribe, 500);\n    return () => clearTimeout(t);\n  }, [conversationId, wsRef]);\n  const send = async () => {\n    const content = inputRef.current.value;\n    if (!content) return;\n    // Persist via REST\n    try {\n      await axios.post('http://localhost:8000/api/messages', {\n        conversation_id: conversationId,\n        content\n      }, {\n        headers: {\n          Authorization: 'Bearer ' + token\n        }\n      });\n    } catch (e) {\n      console.error(e);\n    }\n    // Send via WS for real-time\n    const ws = wsRef.current;\n    const payload = {\n      type: 'message',\n      conversation_id: conversationId,\n      from: user.name,\n      content\n    };\n    try {\n      ws && ws.send(JSON.stringify(payload));\n    } catch (e) {\n      console.error(e);\n    }\n    setMessages(m => [...m, {\n      from: user.name,\n      content\n    }]);\n    inputRef.current.value = '';\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 16\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: [\"Chat #\", conversationId]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        height: '70vh',\n        overflow: 'auto',\n        border: '1px solid #eee',\n        padding: 8\n      },\n      children: messages.map((m, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"b\", {\n          children: m.from\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 44\n        }, this), \": \", m.content]\n      }, i, true, {\n        fileName: _jsxFileName,\n        lineNumber: 55,\n        columnNumber: 31\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 8\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        ref: inputRef,\n        style: {\n          width: '80%'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: send,\n        children: \"Enviar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 59,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 52,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatWindow, \"gvcTo3rHuTPQSsugb0rYnFdNW7M=\", false, function () {\n  return [useWebSocket];\n});\n_c = ChatWindow;\nvar _c;\n$RefreshReg$(_c, \"ChatWindow\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useWebSocket","axios","jsxDEV","_jsxDEV","ChatWindow","user","conversationId","token","_s","messages","setMessages","wsRef","data","conversation_id","m","from","content","system","inputRef","get","headers","Authorization","then","r","catch","trySubscribe","ws","current","readyState","send","JSON","stringify","type","t","setTimeout","clearTimeout","value","post","e","console","error","payload","name","style","padding","children","fileName","_jsxFileName","lineNumber","columnNumber","height","overflow","border","map","i","marginTop","ref","width","onClick","_c","$RefreshReg$"],"sources":["/workspaces/ChatBot-e-Mensageria/frontend/src/components/ChatWindow.js"],"sourcesContent":["import React, {useEffect, useState, useRef} from 'react';\nimport useWebSocket from '../hooks/useWebSocket';\nimport axios from 'axios';\n\nexport default function ChatWindow({user, conversationId, token}){\n  const [messages, setMessages] = useState([]);\n  const wsRef = useWebSocket('ws://localhost:8080/?token='+token, (data)=>{\n    if (!data) return;\n    if (data.conversation_id == conversationId) setMessages(m=>[...m,{from:data.from,content:data.content,system:false}]);\n  });\n  const inputRef = useRef();\n\n  useEffect(()=>{\n    // Load history via REST\n    axios.get('http://localhost:8000/api/conversations/'+conversationId+'/messages',{headers:{Authorization:'Bearer '+token}})\n      .then(r=>setMessages(r.data))\n      .catch(()=>{});\n  },[conversationId, token]);\n\n  // subscribe to conversation on WS when ready\n  useEffect(()=>{\n    const trySubscribe = ()=>{\n      const ws = wsRef.current;\n      if (ws && ws.readyState === 1){\n        ws.send(JSON.stringify({type:'subscribe',conversation_id:conversationId}));\n      }\n    };\n    // try immediately and again after short delay (ws may still be opening)\n    trySubscribe();\n    const t = setTimeout(trySubscribe, 500);\n    return ()=>clearTimeout(t);\n  },[conversationId, wsRef]);\n\n  const send = async ()=>{\n    const content = inputRef.current.value;\n    if (!content) return;\n    // Persist via REST\n    try{\n      await axios.post('http://localhost:8000/api/messages',{conversation_id:conversationId,content},{headers:{Authorization:'Bearer '+token}});\n    }catch(e){ console.error(e); }\n    // Send via WS for real-time\n    const ws = wsRef.current;\n    const payload = {type:'message',conversation_id:conversationId,from:user.name,content};\n    try{\n      ws && ws.send(JSON.stringify(payload));\n    }catch(e){ console.error(e); }\n    setMessages(m=>[...m,{from:user.name,content}]);\n    inputRef.current.value = '';\n  };\n\n  return (\n    <div style={{padding:16}}>\n      <h3>Chat #{conversationId}</h3>\n      <div style={{height:'70vh',overflow:'auto',border:'1px solid #eee',padding:8}}>\n        {messages.map((m,i)=>(<div key={i}><b>{m.from}</b>: {m.content}</div>))}\n      </div>\n      <div style={{marginTop:8}}>\n        <input ref={inputRef} style={{width:'80%'}} />\n        <button onClick={send}>Enviar</button>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}